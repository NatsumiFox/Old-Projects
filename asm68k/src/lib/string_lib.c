#include <stdint.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#include <lib/compat.h>
#include <lib/lengthstring.h>

//////////////////////////////////////////////////////////////////////////////
// Main variables
//////////////////////////////////////////////////////////////////////////////

uint8_t String_TabWidth = 8;

//////////////////////////////////////////////////////////////////////////////
// Main function
//////////////////////////////////////////////////////////////////////////////

int8_t String_HexCharToInt(char ch) {
	// this is a number character, so check if its valid
	if (ch >= '0' && ch <= '9') {
		return ch - '0';

	} else if (ch >= 'A' && ch <= 'F') {
		return ch - 'A' + 0xA;

	} else if (ch >= 'a' && ch <= 'f') {
		return ch - 'a' + 0xA;
	}

	return -1;
}

uint32_t String_PadBuffer(char** buffer, uint32_t target, uint32_t current) {
	// do not over-pad buffer
	if (current >= target) {
		return 0;
	}

	// calculate number of tabs
	int32_t tabs = ((target - current - 1) / String_TabWidth) + 1, tabc = tabs;

	// write that many tabs
	while (--tabc >= 0) {
		**buffer = '\t';
		(*buffer)++;
	}

	return tabs;
}

// clang-format off
char String_UpperCaseHexLUT[16] = {
	'0', '1', '2', '3', '4', '5', '6', '7',
	'8', '9', 'A', 'B', 'C', 'D', 'E', 'F',
};
// clang-format on

char String_LowerCaseLUT[256] = {
		0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, // 00
		0x80, ' ', 0x80, 0x80, 0x80, 0x80, 0x80, 0x80,	// 08
		0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, // 10
		0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, // 18

		' ', '!', '"', '#', '$', '%', '&', '\'', // 20
		'(', ')', '*', '+', ',', '-', '.', '/',	 // 28
		'0', '1', '2', '3', '4', '5', '6', '7',	 // 30
		'8', '9', ':', ';', '<', '=', '>', '?',	 // 38

		'@', 'A', 'B', 'C', 'D', 'E', 'F', 'G',	 // 40
		'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O',	 // 48
		'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W',	 // 50
		'X', 'Y', 'Z', '[', '\\', ']', '^', '_', // 58

		'`', 'a', 'b', 'c', 'd', 'e', 'f', 'g',	 // 60
		'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o',	 // 68
		'p', 'q', 'r', 's', 't', 'u', 'v', 'w',	 // 70
		'x', 'y', 'z', '{', '|', '}', '~', 0x80, // 78

		0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, // 80
		0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, // 88
		0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, // 90
		0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, // 98
		0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, // A0
		0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, // A8
		0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, // B0
		0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, // B8
		0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, // C0
		0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, // C8
		0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, // D0
		0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, // D8
		0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, // E0
		0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, // E8
		0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, // F0
		0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, // F8
};
